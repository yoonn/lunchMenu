<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<!-- <link rel="stylesheet" href="./pretendard.css"> -->
		<script src="https://code.jquery.com/jquery-3.6.3.min.js"></script>
		<style>

			* {
				font-family: Pretendard;
			}

			body {
				background: #f7f8fc;
				height : 960px;
			}

			canvas {
				margin-top : 100px;	
				transition: 20s;
			}

			button {
				z-index : 1000;
				background: #febf00;
				margin-top: 1rem;
				padding: .5rem 1.5rem;
				border: none;
				font-size: 1rem;
				font-weight: bold;
				border-radius: 5px;
				transition: .2s;
				cursor: pointer;
			}

			button:active {
				background: #444;
				color: #f9f9f9;
			}

			#menu {
				width: 100%;
				height : 960px;
				overflow: hidden;
				display: flex;
				align-items: center;
				text-align : center;
				flex-direction: column;
				position: relative;
			}

			#menu::before {
				margin-top : 100px; 
				content: "";
				position: absolute;
				width: 10px;
				height: 50px;
				border-radius: 5px;
				background: #000;
				top: -20px;
				left: 50%;
				transform: translateX(-50%);
				z-index: 22;
			}

			input {
				height: 40px;
				font-size: 1rem;
				font-weight: bold;
			}
		</style>
	</head>
	<body>
		<div id="menu">
			<canvas width="400px" height="400px"></canvas>	
			<button onclick="rotate()">ëŒë ¤ëŒë ¤ ëŒë¦¼íŒ</button>
			<div style="margin-top: 20px;">
				<input type="text" id="selectedMenu" disabled="true" style="text-align: center;">
			</div>
			<div style="margin-top: 20px;">
				ë©”ë‰´ì¶”ê°€ëŠ” ì˜¤ëŒ€ë¦¬í•œí…ŒğŸ’¬
			</div>
			<!-- <div id="addDiv">
				<input type="text" id="menuAdd">
				<button onclick="add()">ë©”ë‰´ ì¶”ê°€</button>
			</div> -->
		</div>

		<script>
			const $c = document.querySelector("canvas");
			const ctx = $c.getContext(`2d`);
			const menuAdd = document.querySelector('#menuAdd');
			const product = [
				'ì• í”Œê¹€ë°¥',
				'ìŒ€êµ­ìˆ˜',
				'ëŒ€ë°•ëˆê¹ŒìŠ¤',
				'íˆë˜ì‹œ',
				'êµ­í’ì„¤ë íƒ•',
				'ì¶˜ì²œë‹­ê°ˆë¹„',
				'ë°±ì–µë°˜ì ',
				'ë„ì§¬ë½•',
				'ê¹€ì¹˜ë‘ë£¨ì¹˜ê¸°',
				'ì–‘í‘¼ì´ê¹€ì¹˜ì°Œê°œ',
				'í†µë¼ì§€ê¹€ì¹˜ì°Œê°œ',
				'ë°•ê°€ë„¤ì¹¼êµ­ìˆ˜',
				'ì‹œì¹´ê³ ë¶€ëŒ€ì°Œê°œ',
				'ì¡°ì„ ê°ìíƒ•',
				'ë§ˆëŠ˜í†µë‹­ì†ì¹¼êµ­ìˆ˜',
			];
			product.sort(() => 0.5 - Math.random());
			let colors = [];

			const newMake = () => {
				const [cw, ch] = [$c.width / 2, $c.height / 2];
				const arc = Math.PI / (product.length / 2);

				colors = [];
				for(var l=0; l<product.length; l++){
					let r = Math.floor(Math.random() * 256);
					let g = Math.floor(Math.random() * 256);
					let b = Math.floor(Math.random() * 256);
					colors.push("rgb(" + r + "," + g + "," + b + ")");
				}

				for (let i = 0; i < product.length; i++) {
					ctx.beginPath();
					ctx.fillStyle = colors[i];
					ctx.moveTo(cw, ch);
					ctx.arc(cw, ch, cw, arc * (i - 1), arc * i);
					ctx.fill();
					ctx.closePath();
				}

				ctx.fillStyle = "white";
				ctx.lineWidth = 0.5;
				ctx.font = "18px Pretendard";
				ctx.textAlign = "center";

				for (let i = -1; i < product.length-1; i++) {
					const angle = (arc * i) + (arc / 2);

					ctx.save();

					ctx.translate(
						cw + Math.cos(angle) * (cw - 30),
						ch + Math.sin(angle) * (ch - 30)
					);

					ctx.rotate(angle + Math.PI / 2);

					product[i+1].split(" ").forEach((text, j) => {
					let y = 0;
					for (let i = 0; i < text.length; i++) {
							ctx.fillText(text[i], 0, y);
							y += 23; // í•œ ê¸€ìì”© ì•„ë˜ë¡œ ë‚´ë¦¼
							}
					});

					ctx.restore();
				}
			}

			const rotate = () => {
				$c.style.transform = `initial`;
				$c.style.transition = `initial`;
				const alpha = Math.floor(Math.random()*100);

				setTimeout(() => {
					const ran = Math.floor(Math.random() * product.length); // ì„ íƒëœ ì¸ë±ìŠ¤
					const arc = 360 / product.length;
					const fullRotations = 10; // 10ë°”í€´
					const rotate = (fullRotations * 360) + (ran * arc) + (arc / 2); // ê°€ìš´ë° ë§ì¶”ê¸°

					$c.style.transform = `rotate(-${rotate}deg)`;
					$c.style.transition = `0.5s`;

					setTimeout(() => {
						const xy = getOriginalCoordinates(ctx, $c.width/2, $c.height/4, rotate);
						const pixel = ctx.getImageData(xy.x, xy.y, 1, 1).data;
						const [r, g, b, a] = pixel;
						const idx = colors.indexOf("rgb(" + r + "," + g + "," + b + ")");

						document.getElementById("selectedMenu").value = product[idx];
					}, 500);

				}, 1);
			};

			function getOriginalCoordinates(ctx, rotatedX, rotatedY, rotateAngle) {
				const centerX = $c.width / 2;
				const centerY = $c.height / 2;
				const angle = (rotateAngle * Math.PI) / 180;

				const originalX = Math.cos(angle) * (rotatedX - centerX) - Math.sin(angle) * (rotatedY - centerY) + centerX;
				const originalY = Math.sin(angle) * (rotatedX - centerX) + Math.cos(angle) * (rotatedY - centerY) + centerY;

				return { x: originalX, y: originalY };
			}

			// function add(){
			//	 if(menuAdd.value != undefined && menuAdd.value != ""){
			//	 product.push(menuAdd.value);
			//	 // let r = Math.floor(Math.random() * 256);
			//	 // let g = Math.floor(Math.random() * 256);
			//	 // let b = Math.floor(Math.random() * 256);
			//	 newMake();
			//	 menuAdd.value="";
			//	 }
			//	 else{
			//	 alert("ë©”ë‰´ë¥¼ ì…ë ¥í•œ í›„ ë²„íŠ¼ì„ í´ë¦­ í•´ ì£¼ì„¸ìš”");
			//	 }
			// }

			newMake();

		</script>
	</body>
</html>